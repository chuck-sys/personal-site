<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="/css/main.css">

<!-- Custom stylesheets -->


    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>lambda lambda - angstrom 2021 | Cheuk’s Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="lambda lambda - angstrom 2021" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="lambda lambda [rev 130 points] lambda lambda lambda…. lambda? 2692665569775536810618960607010822800159298089096272924 hint: Ever hear about lambda calculus?" />
<meta property="og:description" content="lambda lambda [rev 130 points] lambda lambda lambda…. lambda? 2692665569775536810618960607010822800159298089096272924 hint: Ever hear about lambda calculus?" />
<meta property="og:site_name" content="Cheuk’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-07T12:06:00-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="lambda lambda - angstrom 2021" />
<script type="application/ld+json">
{"headline":"lambda lambda - angstrom 2021","dateModified":"2021-04-07T12:06:00-07:00","datePublished":"2021-04-07T12:06:00-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"/writeup/2021/04/07/lambda-angstrom2021.html"},"description":"lambda lambda [rev 130 points] lambda lambda lambda…. lambda? 2692665569775536810618960607010822800159298089096272924 hint: Ever hear about lambda calculus?","@type":"BlogPosting","url":"/writeup/2021/04/07/lambda-angstrom2021.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    
  <head>

  <body>
    <div class="wrapper">
      <nav>
  <a href="/" class="nav-title">
    Cheuk's Blog
  </a>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <a class="nav-links" href="/resources/">Resources</a>
  
  
  
  
  
  
  
  
  
  
  
  <a class="nav-links" href="/about/">About</a>
  
  
</nav>

      
      <article class="post">
  <h1 class="title">lambda lambda - angstrom 2021</h1>
  <span>
    <span>
    Tags:
    
    <a href="/tag/ctf">
      ctf
    </a>
    
    <a href="/tag/writeup">
      writeup
    </a>
    
    <a href="/tag/python">
      python
    </a>
    
    <a href="/tag/racket">
      racket
    </a>
    
    <a href="/tag/lambda">
      lambda
    </a>
    
    </span>
    <span class="meta">07 Apr 2021</span>
  </span>

  <blockquote>
  <p><strong>lambda lambda</strong> [rev 130 points]</p>

  <p>lambda lambda lambda…. <a href="/res/ctf-static/angstrom2021-lambda.py">lambda</a>?</p>

  <p><code class="language-plaintext highlighter-rouge">2692665569775536810618960607010822800159298089096272924</code></p>

  <p>hint: Ever hear about lambda calculus?</p>
</blockquote>

<p>With my 2 semesters worth of experience in programming languages and compiler construction in Racket, I
thought I had the necessary skills to take this on. Here are the 2 approaches I took:</p>

<ol>
  <li><strong><a href="#analysis">Analysis</a>.</strong> By analyzing the lambdas in the code, I hoped to gain some understanding of
what the code actually did. <a href="#analysis">Static</a> and <a href="#dynamic-analysis">Dynamic</a> were used.</li>
  <li><strong><a href="#brute-force">Brute force</a>.</strong> By guessing what the lambdas did, I treated the code as an oracle and
brute-forced a byte-by-byte decryption.</li>
</ol>

<h2 id="analysis">Analysis</h2>

<p>There are 2 types of analysis you can do on this code: static analysis and dynamic analysis. For static
analysis, I used Racket library <code class="language-plaintext highlighter-rouge">python</code> to parse the syntax and isolate the lambdas. I translated these
from the library’s format into actual lambdas and did pattern matching on the terms. For instance, if we
encounter the pattern <code class="language-plaintext highlighter-rouge">(lambda (x) x)</code>, we identify it as the <code class="language-plaintext highlighter-rouge">identity</code> function. Another example would
be the Y-combinator, which does recursion by what I learned as “just-in-time” environment substitution.
Here’s the function for this kind of pattern recognition:</p>

<div class="language-racket highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;; Do pattern matching on the program</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">optimize-lambdas</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">-opt</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">match</span> <span class="nv">x</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="ss">'identity</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="o">,</span><span class="nv">a</span> <span class="mi">1</span><span class="p">))</span> <span class="ss">'add1</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="nv">b</span> <span class="o">,</span><span class="nv">a</span><span class="p">)))</span> <span class="ss">'reverse-args</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="o">,</span><span class="nv">a</span><span class="p">))</span> <span class="ss">'sel1</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="o">,</span><span class="nv">b</span><span class="p">))</span> <span class="ss">'sel2</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="o">,</span><span class="nv">b</span><span class="p">)))</span> <span class="ss">'sel3</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">g</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span> <span class="p">((</span><span class="o">,</span><span class="nv">g</span> <span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="o">,</span><span class="nv">b</span><span class="p">)))))</span> <span class="ss">'X</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="p">((</span><span class="o">,</span><span class="nv">a</span> <span class="nv">X</span><span class="p">)</span> <span class="o">,</span><span class="nv">b</span><span class="p">)))</span> <span class="ss">'aXb</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">g</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span> <span class="p">(</span><span class="o">,</span><span class="nv">b</span> <span class="o">,</span><span class="nv">g</span><span class="p">)))))</span> <span class="ss">'abg</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">g</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">e</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span><span class="p">)</span> <span class="p">(((</span><span class="o">,</span><span class="nv">g</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">q</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="nv">q</span> <span class="p">(</span><span class="o">,</span><span class="nv">p</span> <span class="o">,</span><span class="nv">e</span><span class="p">)))))</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">n</span><span class="p">)</span> <span class="o">,</span><span class="nv">f</span><span class="p">))</span> <span class="nv">identity</span><span class="p">))))</span>
        <span class="ss">'fun1</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="p">((</span><span class="o">,</span><span class="nv">b</span> <span class="nv">fun1</span><span class="p">)</span> <span class="o">,</span><span class="nv">a</span><span class="p">)))</span> <span class="ss">'fun2</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">((</span><span class="o">,</span><span class="nv">a</span> <span class="nv">sel3</span><span class="p">)</span> <span class="nv">sel1</span><span class="p">))</span> <span class="ss">'fun31</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">((</span><span class="o">,</span><span class="nv">a</span> <span class="nv">sel2</span><span class="p">)</span> <span class="nv">sel1</span><span class="p">))</span> <span class="ss">'fun21</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">fun31</span> <span class="p">((</span><span class="nf">fun2</span> <span class="p">(</span><span class="nf">X</span> <span class="o">,</span><span class="nv">a</span><span class="p">))</span> <span class="o">,</span><span class="nv">b</span><span class="p">))))</span> <span class="ss">'fun4</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span><span class="p">)</span>
           <span class="p">((</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">x1</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">x2</span><span class="p">)</span> <span class="p">((</span><span class="o">,</span><span class="nv">x1</span> <span class="o">,</span><span class="nv">x1</span><span class="p">)</span> <span class="o">,</span><span class="nv">x2</span><span class="p">))))</span>
            <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">x3</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">x4</span><span class="p">)</span> <span class="p">((</span><span class="o">,</span><span class="nv">x3</span> <span class="o">,</span><span class="nv">x3</span><span class="p">)</span> <span class="o">,</span><span class="nv">x4</span><span class="p">))))))</span>
        <span class="ss">'Y</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span><span class="p">)</span>
           <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">x</span><span class="p">)</span>
              <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="o">,</span><span class="nv">x</span><span class="p">))))))))))))))))))</span>
        <span class="ss">'apply-16-times</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="o">,</span><span class="nv">x</span><span class="p">))))</span>
        <span class="ss">'apply-2-times</span><span class="p">]</span>

      <span class="p">[</span><span class="o">`</span><span class="p">((</span><span class="nf">reverse-args</span> <span class="nv">apply-2-times</span><span class="p">)</span> <span class="o">,</span><span class="nv">x</span><span class="p">)</span>
        <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">x</span> <span class="nv">apply-2-times</span><span class="p">)]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">((</span><span class="nf">sel1</span> <span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="nv">a</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">((</span><span class="nf">sel2</span> <span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="nv">b</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(((</span><span class="nf">sel3</span> <span class="o">,</span><span class="nv">n</span><span class="p">)</span> <span class="o">,</span><span class="nv">a</span><span class="p">)</span> <span class="o">,</span><span class="nv">b</span><span class="p">)</span> <span class="nv">b</span><span class="p">]</span>

      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">file</span><span class="p">)</span>
           <span class="p">((</span><span class="nf">Y</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">t</span><span class="p">)</span> <span class="p">((</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">not-cond</span><span class="p">)</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">not</span> <span class="o">,</span><span class="nv">not-cond</span><span class="p">)</span> <span class="o">,</span><span class="nv">t</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span> <span class="p">(</span><span class="nf">X</span> <span class="o">,</span><span class="nv">t</span><span class="p">))))</span>
                                       <span class="p">(</span><span class="nb">read</span> <span class="o">,</span><span class="nv">file</span> <span class="mi">1000</span><span class="p">)))))</span>
            <span class="nv">sel2</span><span class="p">))</span>
        <span class="ss">'read-1000</span><span class="p">]</span>
      <span class="p">[</span><span class="o">`</span><span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">x</span><span class="p">)</span>
           <span class="p">((</span><span class="nf">Y</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">f-f</span><span class="p">)</span> <span class="p">(</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">X-F</span><span class="p">)</span>
                                <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">eq?</span> <span class="p">((</span><span class="k">λ</span> <span class="p">(</span><span class="o">,</span><span class="nv">f</span><span class="p">)</span> <span class="p">((</span><span class="o">,</span><span class="nv">f</span> <span class="nv">add1</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="o">,</span><span class="nv">X-F</span><span class="p">)</span> <span class="o">,</span><span class="nv">x</span><span class="p">)</span>
                                  <span class="o">,</span><span class="nv">X-F</span>
                                  <span class="p">(</span><span class="o">,</span><span class="nv">f-f</span> <span class="p">(</span><span class="nf">X</span> <span class="o">,</span><span class="nv">X-F</span><span class="p">))))))</span>
            <span class="nv">identity</span><span class="p">))</span>
        <span class="ss">'main</span><span class="p">]</span>

      <span class="p">[</span><span class="o">`</span><span class="p">((</span><span class="nf">get-field</span> <span class="nv">read</span> <span class="o">,</span><span class="nv">x</span><span class="p">)</span> <span class="o">,</span><span class="nv">num</span><span class="p">)</span> <span class="nt">#:when</span> <span class="p">(</span><span class="nb">number?</span> <span class="nv">num</span><span class="p">)</span> <span class="o">`</span><span class="p">(</span><span class="nb">read</span> <span class="o">,</span><span class="nv">x</span> <span class="o">,</span><span class="nv">num</span><span class="p">)]</span>
      <span class="p">[</span><span class="nf">exprs</span> <span class="nt">#:when</span> <span class="p">(</span><span class="nb">list?</span> <span class="nv">exprs</span><span class="p">)</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">-opt</span> <span class="nv">exprs</span><span class="p">)]</span>
      <span class="p">[</span><span class="nf">else</span> <span class="nv">x</span><span class="p">]))</span>

  <span class="p">(</span><span class="nf">-opt</span> <span class="p">(</span><span class="nf">-opt</span> <span class="p">(</span><span class="nf">-opt</span> <span class="p">(</span><span class="nf">-opt</span> <span class="p">(</span><span class="nf">-opt</span> <span class="nv">x</span><span class="p">))))))</span>
</code></pre></div></div>

<p>Output (click <a href="#end-of-output">here</a> to skip to the bottom of the output):</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(((((</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g176</span><span class="p">)</span>
      <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g177</span><span class="p">)</span>
        <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g178</span><span class="p">)</span>
          <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g179</span><span class="p">)</span>
            <span class="p">(((</span><span class="nv">Y</span>
               <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g185</span><span class="p">)</span>
                 <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g186</span><span class="p">)</span>
                   <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g187</span><span class="p">)</span>
                     <span class="p">(((</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g188</span><span class="p">)</span>
                         <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g189</span><span class="p">)</span>
                           <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">not</span> <span class="nv">g188</span><span class="p">)</span>
                             <span class="nv">g186</span>
                             <span class="p">((</span><span class="nv">g185</span>
                               <span class="p">(</span><span class="nb">+</span>
                                <span class="p">(</span><span class="nb">*</span> <span class="nv">g186</span> <span class="mi">256</span><span class="p">)</span>
                                <span class="p">((</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g190</span><span class="p">)</span> <span class="p">((</span><span class="nv">g190</span> <span class="nv">add1</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
                                 <span class="p">((</span><span class="nv">aXb</span> <span class="nv">g178</span><span class="p">)</span>
                                  <span class="p">((</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g197</span><span class="p">)</span>
                                     <span class="p">((</span><span class="nv">aXb</span>
                                       <span class="p">((</span><span class="nv">abg</span>
                                         <span class="p">(((</span><span class="nv">Y</span>
                                            <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g211</span><span class="p">)</span>
                                              <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g212</span><span class="p">)</span>
                                                <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g213</span><span class="p">)</span>
                                                  <span class="p">(((((</span><span class="nv">fun4</span> <span class="nv">g212</span><span class="p">)</span> <span class="nv">g213</span><span class="p">)</span>
                                                     <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g234</span><span class="p">)</span> <span class="nv">g212</span><span class="p">))</span>
                                                    <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g235</span><span class="p">)</span>
                                                      <span class="p">((</span><span class="nv">g211</span>
                                                        <span class="p">((</span><span class="nv">fun2</span> <span class="nv">g212</span><span class="p">)</span> <span class="nv">g213</span><span class="p">))</span>
                                                       <span class="nv">g213</span><span class="p">)))</span>
                                                   <span class="nv">sel2</span><span class="p">)))))</span>
                                           <span class="nv">g197</span><span class="p">)</span>
                                          <span class="nv">apply-16-times</span><span class="p">))</span>
                                        <span class="nv">apply-16-times</span><span class="p">))</span>
                                      <span class="p">(((</span><span class="nv">Y</span>
                                         <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g256</span><span class="p">)</span>
                                           <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g257</span><span class="p">)</span>
                                             <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g258</span><span class="p">)</span>
                                               <span class="p">(((((</span><span class="nv">fun4</span> <span class="nv">g257</span><span class="p">)</span> <span class="nv">g258</span><span class="p">)</span> <span class="nv">sel3</span><span class="p">)</span>
                                                 <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g282</span><span class="p">)</span>
                                                   <span class="p">(</span><span class="nv">X</span>
                                                    <span class="p">((</span><span class="nv">g256</span> <span class="p">((</span><span class="nv">fun2</span> <span class="nv">g257</span><span class="p">)</span> <span class="nv">g258</span><span class="p">))</span>
                                                     <span class="nv">g258</span><span class="p">))))</span>
                                                <span class="nv">sel2</span><span class="p">)))))</span>
                                        <span class="nv">g197</span><span class="p">)</span>
                                       <span class="nv">apply-16-times</span><span class="p">)))</span>
                                   <span class="p">(((</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g299</span><span class="p">)</span>
                                       <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g300</span><span class="p">)</span>
                                         <span class="p">(((</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g301</span><span class="p">)</span>
                                             <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g302</span><span class="p">)</span>
                                               <span class="p">(((((</span><span class="nv">Y</span>
                                                    <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g308</span><span class="p">)</span>
                                                      <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g309</span><span class="p">)</span>
                                                        <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g310</span><span class="p">)</span>
                                                          <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g311</span><span class="p">)</span>
                                                            <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g312</span><span class="p">)</span>
                                                              <span class="p">((((((</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g313</span><span class="p">)</span>
                                                                     <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g314</span><span class="p">)</span>
                                                                       <span class="p">((</span><span class="nv">g313</span>
                                                                         <span class="nv">sel1</span><span class="p">)</span>
                                                                        <span class="nv">g314</span><span class="p">)))</span>
                                                                   <span class="p">(</span><span class="nv">g301</span>
                                                                    <span class="nv">g310</span><span class="p">))</span>
                                                                  <span class="p">(</span><span class="nv">g301</span> <span class="nv">g311</span><span class="p">))</span>
                                                                 <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g317</span><span class="p">)</span>
                                                                   <span class="p">(((</span><span class="nv">g301</span>
                                                                      <span class="nv">g310</span><span class="p">)</span>
                                                                     <span class="p">((</span><span class="nv">aXb</span>
                                                                       <span class="nv">g309</span><span class="p">)</span>
                                                                      <span class="p">((</span><span class="nv">g302</span>
                                                                        <span class="nv">g311</span><span class="p">)</span>
                                                                       <span class="p">(</span><span class="nv">g312</span>
                                                                        <span class="nv">apply-2-times</span><span class="p">))))</span>
                                                                    <span class="p">((</span><span class="nv">aXb</span>
                                                                      <span class="nv">g309</span><span class="p">)</span>
                                                                     <span class="p">((</span><span class="nv">g302</span>
                                                                       <span class="nv">g310</span><span class="p">)</span>
                                                                      <span class="p">(</span><span class="nv">g312</span>
                                                                       <span class="nv">apply-2-times</span><span class="p">))))))</span>
                                                                <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g336</span><span class="p">)</span>
                                                                  <span class="p">((((</span><span class="nv">g308</span>
                                                                      <span class="p">((</span><span class="nv">aXb</span>
                                                                        <span class="nv">g309</span><span class="p">)</span>
                                                                       <span class="p">((</span><span class="nv">g302</span>
                                                                         <span class="p">(</span><span class="nv">g312</span>
                                                                          <span class="nv">apply-2-times</span><span class="p">))</span>
                                                                        <span class="p">(((</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g346</span><span class="p">)</span>
                                                                            <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g347</span><span class="p">)</span>
                                                                              <span class="p">(((((</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g348</span><span class="p">)</span>
                                                                                    <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g349</span><span class="p">)</span>
                                                                                      <span class="p">((</span><span class="nv">g348</span>
                                                                                        <span class="nv">sel1</span><span class="p">)</span>
                                                                                       <span class="nv">g349</span><span class="p">)))</span>
                                                                                  <span class="p">(((</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g352</span><span class="p">)</span>
                                                                                      <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g353</span><span class="p">)</span>
                                                                                        <span class="p">((</span><span class="nv">g352</span>
                                                                                          <span class="nv">g353</span><span class="p">)</span>
                                                                                         <span class="nv">sel2</span><span class="p">)))</span>
                                                                                    <span class="p">(</span><span class="nv">g301</span>
                                                                                     <span class="nv">g346</span><span class="p">))</span>
                                                                                   <span class="p">(</span><span class="nv">fun21</span>
                                                                                    <span class="p">(</span><span class="nv">g301</span>
                                                                                     <span class="nv">g347</span><span class="p">))))</span>
                                                                                 <span class="p">(((</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g361</span><span class="p">)</span>
                                                                                     <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g362</span><span class="p">)</span>
                                                                                       <span class="p">((</span><span class="nv">g361</span>
                                                                                         <span class="nv">g362</span><span class="p">)</span>
                                                                                        <span class="nv">sel2</span><span class="p">)))</span>
                                                                                   <span class="p">(</span><span class="nv">g301</span>
                                                                                    <span class="nv">g347</span><span class="p">))</span>
                                                                                  <span class="p">(</span><span class="nv">fun21</span>
                                                                                   <span class="p">(</span><span class="nv">g301</span>
                                                                                    <span class="nv">g346</span><span class="p">))))</span>
                                                                                <span class="nb">identity</span><span class="p">)</span>
                                                                               <span class="nv">sel2</span><span class="p">)))</span>
                                                                          <span class="p">(((</span><span class="nv">Y</span>
                                                                             <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g378</span><span class="p">)</span>
                                                                               <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g379</span><span class="p">)</span>
                                                                                 <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g380</span><span class="p">)</span>
                                                                                   <span class="p">(((((</span><span class="nv">fun4</span>
                                                                                        <span class="nv">g379</span><span class="p">)</span>
                                                                                       <span class="nv">g380</span><span class="p">)</span>
                                                                                      <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g401</span><span class="p">)</span>
                                                                                        <span class="nv">g379</span><span class="p">))</span>
                                                                                     <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g402</span><span class="p">)</span>
                                                                                       <span class="p">((</span><span class="nv">g378</span>
                                                                                         <span class="p">((</span><span class="nv">fun2</span>
                                                                                           <span class="nv">g379</span><span class="p">)</span>
                                                                                          <span class="nv">g380</span><span class="p">))</span>
                                                                                        <span class="nv">g380</span><span class="p">)))</span>
                                                                                    <span class="nv">sel2</span><span class="p">)))))</span>
                                                                            <span class="nv">g310</span><span class="p">)</span>
                                                                           <span class="nv">apply-2-times</span><span class="p">))</span>
                                                                         <span class="p">(((</span><span class="nv">Y</span>
                                                                            <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g421</span><span class="p">)</span>
                                                                              <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g422</span><span class="p">)</span>
                                                                                <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g423</span><span class="p">)</span>
                                                                                  <span class="p">(((((</span><span class="nv">fun4</span>
                                                                                       <span class="nv">g422</span><span class="p">)</span>
                                                                                      <span class="nv">g423</span><span class="p">)</span>
                                                                                     <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g444</span><span class="p">)</span>
                                                                                       <span class="nv">g422</span><span class="p">))</span>
                                                                                    <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g445</span><span class="p">)</span>
                                                                                      <span class="p">((</span><span class="nv">g421</span>
                                                                                        <span class="p">((</span><span class="nv">fun2</span>
                                                                                          <span class="nv">g422</span><span class="p">)</span>
                                                                                         <span class="nv">g423</span><span class="p">))</span>
                                                                                       <span class="nv">g423</span><span class="p">)))</span>
                                                                                   <span class="nv">sel2</span><span class="p">)))))</span>
                                                                           <span class="nv">g311</span><span class="p">)</span>
                                                                          <span class="nv">apply-2-times</span><span class="p">)))))</span>
                                                                     <span class="p">(((</span><span class="nv">Y</span>
                                                                        <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g464</span><span class="p">)</span>
                                                                          <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g465</span><span class="p">)</span>
                                                                            <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g466</span><span class="p">)</span>
                                                                              <span class="p">(((((</span><span class="nv">fun4</span>
                                                                                   <span class="nv">g465</span><span class="p">)</span>
                                                                                  <span class="nv">g466</span><span class="p">)</span>
                                                                                 <span class="nv">sel3</span><span class="p">)</span>
                                                                                <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g490</span><span class="p">)</span>
                                                                                  <span class="p">(</span><span class="nv">X</span>
                                                                                   <span class="p">((</span><span class="nv">g464</span>
                                                                                     <span class="p">((</span><span class="nv">fun2</span>
                                                                                       <span class="nv">g465</span><span class="p">)</span>
                                                                                      <span class="nv">g466</span><span class="p">))</span>
                                                                                    <span class="nv">g466</span><span class="p">))))</span>
                                                                               <span class="nv">sel2</span><span class="p">)))))</span>
                                                                       <span class="nv">g310</span><span class="p">)</span>
                                                                      <span class="nv">apply-2-times</span><span class="p">))</span>
                                                                    <span class="p">(((</span><span class="nv">Y</span>
                                                                       <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g512</span><span class="p">)</span>
                                                                         <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g513</span><span class="p">)</span>
                                                                           <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g514</span><span class="p">)</span>
                                                                             <span class="p">(((((</span><span class="nv">fun4</span>
                                                                                  <span class="nv">g513</span><span class="p">)</span>
                                                                                 <span class="nv">g514</span><span class="p">)</span>
                                                                                <span class="nv">sel3</span><span class="p">)</span>
                                                                               <span class="p">(</span><span class="err">λ</span> <span class="p">(</span><span class="nv">g538</span><span class="p">)</span>
                                                                                 <span class="p">(</span><span class="nv">X</span>
                                                                                  <span class="p">((</span><span class="nv">g512</span>
                                                                                    <span class="p">((</span><span class="nv">fun2</span>
                                                                                      <span class="nv">g513</span><span class="p">)</span>
                                                                                     <span class="nv">g514</span><span class="p">))</span>
                                                                                   <span class="nv">g514</span><span class="p">))))</span>
                                                                              <span class="nv">sel2</span><span class="p">)))))</span>
                                                                      <span class="nv">g311</span><span class="p">)</span>
                                                                     <span class="nv">apply-2-times</span><span class="p">))</span>
                                                                   <span class="p">(</span><span class="nv">X</span> <span class="nv">g312</span><span class="p">))))</span>
                                                               <span class="nv">sel2</span><span class="p">)))))))</span>
                                                   <span class="nv">sel2</span><span class="p">)</span>
                                                  <span class="nv">g299</span><span class="p">)</span>
                                                 <span class="nv">g300</span><span class="p">)</span>
                                                <span class="nv">sel2</span><span class="p">)))</span>
                                           <span class="nv">fun31</span><span class="p">)</span>
                                          <span class="nv">abg</span><span class="p">)))</span>
                                     <span class="p">(</span><span class="nv">g179</span> <span class="p">(</span><span class="nv">ord</span> <span class="nv">g188</span><span class="p">)))</span>
                                    <span class="p">(</span><span class="nv">g179</span> <span class="p">(</span><span class="nv">ord</span> <span class="nv">g189</span><span class="p">))))))))</span>
                              <span class="p">(</span><span class="nv">X</span> <span class="nv">g187</span><span class="p">)))))</span>
                       <span class="p">(</span><span class="nb">read</span> <span class="nv">g176</span> <span class="mi">1</span><span class="p">))</span>
                      <span class="p">(</span><span class="nb">read</span> <span class="nv">g177</span> <span class="mi">1</span><span class="p">))))))</span>
              <span class="mi">0</span><span class="p">)</span>
             <span class="nv">sel2</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nb">open</span> <span class="s">"./flag.txt"</span><span class="p">))</span>
   <span class="p">(</span><span class="nb">open</span> <span class="nv">__file__</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">read-1000</span> <span class="p">(</span><span class="nb">open</span> <span class="nv">__file__</span><span class="p">)))</span>
 <span class="nv">main</span><span class="p">)</span>
</code></pre></div></div>

<p><a name="end-of-output"></a>As you can see, even with all of this pattern matching, we don’t have much in
terms of readable code. We see that we are reading <code class="language-plaintext highlighter-rouge">lambda.py</code> (which is <code class="language-plaintext highlighter-rouge">__file__</code>) and <code class="language-plaintext highlighter-rouge">flag.txt</code>
character by character (note that parameters <code class="language-plaintext highlighter-rouge">g176</code> and <code class="language-plaintext highlighter-rouge">g177</code> refer to <code class="language-plaintext highlighter-rouge">./flag.txt</code> and <code class="language-plaintext highlighter-rouge">lambda.py</code>
respectively if you follow the lambdas). We do addition and multiplication with some numbers and get some
result somehow, but not much else is known.</p>

<h3 id="dynamic-analysis">Dynamic analysis</h3>

<p>Here comes dynamic analysis to the rescue! We know that <code class="language-plaintext highlighter-rouge">lambda.py</code> outputs a number, and by changing
<code class="language-plaintext highlighter-rouge">flag.txt</code>, we change the output. Maybe by knowing the arguments given to the arithmetic operations, we
can hope to glean some information on what the program actually does.</p>

<p>So I added <code class="language-plaintext highlighter-rouge">printf</code> statements in the Python interpreter. I downloaded Python 3.5.10 source and made a few
modifications. The first thing to do was to find where addition and multiplication were implemented.
Python is special in that there is no limit to the size of <code class="language-plaintext highlighter-rouge">long</code> integers, so I know that addition and
multiplication are not trivially implemented.</p>

<p>After a bit of searching, I find what I’m looking for in <code class="language-plaintext highlighter-rouge">Objects/longobject.c</code> in functions <code class="language-plaintext highlighter-rouge">long_mul(a,
b)</code> and <code class="language-plaintext highlighter-rouge">long_add(a, b)</code>. I add the following lines:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Addition</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"DEBUG: (+ %lu %lu) = %lu</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
       <span class="n">MEDIUM_VALUE</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">MEDIUM_VALUE</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
       <span class="n">MEDIUM_VALUE</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">MEDIUM_VALUE</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
<span class="c1">// Multiplication</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"DEBUG: (* %lu %lu) = %lu</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
       <span class="n">MEDIUM_VALUE</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">MEDIUM_VALUE</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
       <span class="n">MEDIUM_VALUE</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="nf">MEDIUM_VALUE</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
</code></pre></div></div>

<p>They are added within the “fast multiplication”/”fast addition” if statements.</p>

<p>Also note that we call the <code class="language-plaintext highlighter-rouge">ord</code> function, so we add a <code class="language-plaintext highlighter-rouge">printf</code> in <code class="language-plaintext highlighter-rouge">Python/bltinmodules.c</code>
<code class="language-plaintext highlighter-rouge">builtin_ord(module, c)</code>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ord</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="o">*</span><span class="n">PyBytes_AS_STRING</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
<span class="c1">// Add following line after above line</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"DEBUG: ORD('%c') = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="n">PyBytes_AS_STRING</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">ord</span><span class="p">);</span>
</code></pre></div></div>

<p>We build this new interpreter and run <code class="language-plaintext highlighter-rouge">python lambda.py</code> yet again. And for brevity’s sake I’m not going
to include console output because it is 6k lines long.</p>

<p>Unfortunately I didn’t find the output to be too useful. There was just too much noise. And the fact that
the program only ever added 1 in addition (as far as I tested) probably didn’t help.</p>

<h2 id="brute-force">Brute force</h2>

<p>After a while, <a href="https://twitter.com/nneonneo">someone in the ctf team I’m in</a> uploaded their work in
pattern matching, only it was in python. They weren’t done yet, but I noticed something interesting in the
main function:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'./flag.txt'</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'lambda.py'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">g</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">main</span><span class="p">(</span><span class="n">g</span><span class="o">*</span><span class="mi">256</span><span class="o">+</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="p">(</span><span class="s">'insert more lambdas here'</span><span class="p">)),</span> <span class="n">X</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
</code></pre></div></div>

<p>Did you catch it? The variable <code class="language-plaintext highlighter-rouge">g</code> functions as an accumulator. Each time we iterate, we shift <code class="language-plaintext highlighter-rouge">g</code> to the
left by 8 bits and add some result from a function that contains a character from <code class="language-plaintext highlighter-rouge">flag.txt</code> and
<code class="language-plaintext highlighter-rouge">lambda.py</code>. This suggests that each byte of <code class="language-plaintext highlighter-rouge">g</code> is independent of any other byte. Thus we can brute force
each byte. To make things faster, we test bytes against the first 24 bytes of <code class="language-plaintext highlighter-rouge">lambda.py</code>, since that’s
what <code class="language-plaintext highlighter-rouge">open('lambda.py', 'r').read(1)</code> does. The script for my solution is as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">subprocess</span> <span class="k">as</span> <span class="n">sub</span>

<span class="n">ENCRYPTED_FLAG</span> <span class="o">=</span> <span class="mi">2692665569775536810618960607010822800159298089096272924</span>
<span class="n">ENCRYPTED_FLAG</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s">'{:x}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">ENCRYPTED_FLAG</span><span class="p">))</span>

<span class="n">FLAG_FILE</span> <span class="o">=</span> <span class="s">'flag.txt'</span>
<span class="n">LAMBDA_PY</span> <span class="o">=</span> <span class="s">'lambda.py'</span>         <span class="c1"># we will be overwrite this file
</span><span class="n">COPY_LAMBDA</span> <span class="o">=</span> <span class="s">'lambda.py.bak'</span>   <span class="c1"># backup file for copying and pasting each character
</span>
<span class="n">WHAT_WE_HAVE</span> <span class="o">=</span> <span class="s">'actf{3p1c_0n'</span>   <span class="c1"># the script runs pretty slowly; don't want to wait that much
# actf{3p1c_0n3_l1n3r_95}
</span>
<span class="k">print</span><span class="p">(</span><span class="s">'solved: %s'</span> <span class="o">%</span> <span class="n">WHAT_WE_HAVE</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">COPY_LAMBDA</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">PLAINTEXT</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ENCRYPTED_FLAG</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">WHAT_WE_HAVE</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ENCRYPTED_FLAG</span><span class="p">)):</span>
    <span class="n">solved</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">LAMBDA_PY</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="nb">ord</span><span class="p">(</span><span class="n">PLAINTEXT</span><span class="p">[</span><span class="n">i</span><span class="p">])]))</span>

    <span class="c1"># try most sensible ascii values (zero doesn't work and errors out)
</span>    <span class="k">for</span> <span class="n">flag_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">FLAG_FILE</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">flag_i</span><span class="p">]))</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">sub</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'python'</span><span class="p">,</span> <span class="s">'lambda-annotated.py'</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">))</span> <span class="o">==</span> <span class="n">ENCRYPTED_FLAG</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">flag_i</span> <span class="o">&gt;</span> <span class="mi">126</span> <span class="ow">or</span> <span class="n">flag_i</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'0x{:x}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">flag_i</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">flag_i</span><span class="p">))</span>
            <span class="n">solved</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">solved</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Could not solve this character. Skipping.'</span><span class="p">)</span>

<span class="k">print</span><span class="p">()</span>
</code></pre></div></div>

<p>A slight issue occured where the character <code class="language-plaintext highlighter-rouge">3</code> in <code class="language-plaintext highlighter-rouge">0n3</code> was output as <code class="language-plaintext highlighter-rouge">0x3</code>, and the character next to it
couldn’t be solved, leading me to guess those characters.</p>

</article>

<footer class="post-foot">
  <span class="prev">
  
    <span>Prev</span>
    <a href="/writeup/2020/05/26/timed-tjctf.html">Timed - tjctf</a>
  
  </span>
  <span class="next">
  
  </span>
</footer>

    </div>
  </body>

</html>
