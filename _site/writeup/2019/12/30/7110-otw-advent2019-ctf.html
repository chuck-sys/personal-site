<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="/css/main.css">

<!-- Custom stylesheets -->


    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>7110 - OverTheWire Advent 2019 CTF | Cheuk’s Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="7110 - OverTheWire Advent 2019 CTF" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This one was one of the easier ones. We are given some .txt files, .csv files, and a single .h C header file. We see that the .csv files contain keylogging data, where the first column is a timestamp and the second column is the key that was pressed. From these .csv files, we are supposed to figure out what Santa typed." />
<meta property="og:description" content="This one was one of the easier ones. We are given some .txt files, .csv files, and a single .h C header file. We see that the .csv files contain keylogging data, where the first column is a timestamp and the second column is the key that was pressed. From these .csv files, we are supposed to figure out what Santa typed." />
<meta property="og:site_name" content="Cheuk’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-12-30T00:00:00-08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="7110 - OverTheWire Advent 2019 CTF" />
<script type="application/ld+json">
{"headline":"7110 - OverTheWire Advent 2019 CTF","dateModified":"2019-12-30T00:00:00-08:00","datePublished":"2019-12-30T00:00:00-08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/writeup/2019/12/30/7110-otw-advent2019-ctf.html"},"description":"This one was one of the easier ones. We are given some .txt files, .csv files, and a single .h C header file. We see that the .csv files contain keylogging data, where the first column is a timestamp and the second column is the key that was pressed. From these .csv files, we are supposed to figure out what Santa typed.","@type":"BlogPosting","url":"/writeup/2019/12/30/7110-otw-advent2019-ctf.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    
  <head>

  <body>
    <div class="wrapper">
      <nav>
  <a href="/" class="nav-title">
    Cheuk's Blog
  </a>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <a class="nav-links" href="/resources/">Resources</a>
  
  
  
  
  
  
  
  
  
  
  
  <a class="nav-links" href="/about/">About</a>
  
  
</nav>

      
      <article class="post">
  <h1 class="title">7110 - OverTheWire Advent 2019 CTF</h1>
  <span>
    <span>
    Tags:
    
    <a href="/tag/ctf">
      ctf
    </a>
    
    <a href="/tag/writeup">
      writeup
    </a>
    
    <a href="/tag/python">
      python
    </a>
    
    </span>
    <span class="meta">30 Dec 2019</span>
  </span>

  <p>This one was one of the easier ones. We are given some <code class="language-plaintext highlighter-rouge">.txt</code> files, <code class="language-plaintext highlighter-rouge">.csv</code>
files, and a single <code class="language-plaintext highlighter-rouge">.h</code> C header file. We see that the <code class="language-plaintext highlighter-rouge">.csv</code> files contain
keylogging data, where the first column is a timestamp and the second column is
the key that was pressed. From these <code class="language-plaintext highlighter-rouge">.csv</code> files, we are supposed to figure
out what Santa typed.</p>

<p>The <code class="language-plaintext highlighter-rouge">.csv</code> files correspond to the <code class="language-plaintext highlighter-rouge">.txt</code> files (e.g. <code class="language-plaintext highlighter-rouge">sms1.csv</code> corresponds to
<code class="language-plaintext highlighter-rouge">sms1.txt</code>), and we are supposed to decode <code class="language-plaintext highlighter-rouge">sms4.csv</code>. Though we are not
completely sure what the function keys correspond to (i.e. <code class="language-plaintext highlighter-rouge">MENU_LEFT</code>,
<code class="language-plaintext highlighter-rouge">MENU_RIGHT</code>, <code class="language-plaintext highlighter-rouge">MENU_UP</code>, <code class="language-plaintext highlighter-rouge">MENU_DOWN</code>), we can still try to decode the file. And
so we write the following Python code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>

<span class="n">KS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s">" 0"</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s">".,'?!</span><span class="se">\"</span><span class="s">1-()@/:"</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s">"abc2"</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s">"def3"</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s">"ghi4"</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s">"jkl5"</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s">"mno6"</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s">"pqrs7"</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="s">"tuv8"</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="s">"wxyz9"</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="s">"@/:_;+&amp;%*[]{}"</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="s">'T9'</span><span class="p">,</span> <span class="s">'T9_CAPS'</span><span class="p">,</span> <span class="s">'ABC'</span><span class="p">,</span> <span class="s">'ABC_CAPS'</span><span class="p">],</span>
    <span class="mi">100</span><span class="p">:</span> <span class="p">[</span><span class="s">'LEFT'</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)],</span>
    <span class="mi">101</span><span class="p">:</span> <span class="p">[</span><span class="s">'RIGHT'</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)],</span>
    <span class="mi">102</span><span class="p">:</span> <span class="p">[</span><span class="s">'UP'</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)],</span>
    <span class="mi">103</span><span class="p">:</span> <span class="p">[</span><span class="s">'DOWN'</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)],</span>
    <span class="mi">104</span><span class="p">:</span> <span class="p">[</span><span class="s">'CALL_ACCEPT'</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)],</span>
    <span class="mi">105</span><span class="p">:</span> <span class="p">[</span><span class="s">'CALL_REJECT'</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span class="p">}</span>

<span class="n">strokes</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">strokes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">)[</span><span class="mi">1</span><span class="p">])),</span>
                       <span class="n">f</span><span class="p">.</span><span class="n">readlines</span><span class="p">()))</span>

<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">KS</span>
    <span class="k">return</span> <span class="n">KS</span><span class="p">[</span><span class="n">key</span><span class="p">][(</span><span class="n">times</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">KS</span><span class="p">[</span><span class="n">key</span><span class="p">])]</span>

<span class="n">last_ts</span><span class="p">,</span> <span class="n">last_key</span> <span class="o">=</span> <span class="n">strokes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">ts</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">strokes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">if</span> <span class="n">last_key</span> <span class="o">!=</span> <span class="n">key</span><span class="p">:</span>
        <span class="c1"># The keys changed; output
</span>        <span class="k">print</span><span class="p">(</span><span class="n">process</span><span class="p">(</span><span class="n">last_key</span><span class="p">,</span> <span class="n">repeat</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
        <span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">last_ts</span> <span class="o">=</span> <span class="n">ts</span>
        <span class="n">last_key</span> <span class="o">=</span> <span class="n">key</span>
    <span class="k">elif</span> <span class="n">last_key</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
        <span class="c1"># The same key
</span>        <span class="n">repeat</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">last_ts</span> <span class="o">=</span> <span class="n">ts</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># W
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="se">\n</span><span class="s">WATT (ts=</span><span class="si">{</span><span class="n">ts</span><span class="si">}</span><span class="s">, key=</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">)</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<p>In essence, we look up a character based on the number of times we see it
repeated. Let’s try running it:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>python analyze.py sms1.csv
<span class="go">LEFTLEFTLEFTLEFTT9_CAPSrudolf where are you bsLEFTLEFT0m, .l ,p

</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>sms1.txt
<span class="go">date: 1999-11-23 03:01:10
to: 00611015550117
text: rudolf where are you brrr
</span></code></pre></div></div>

<p>If you recall, we were also given the timestamps of each keystroke. Remember
that if you pressed a key and waited long enough, the key would be printed and
you could press another key (even if it is the same key). So we add this delay
into play:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span><span class="n">TS_DELTA</span> <span class="o">=</span> <span class="mi">900</span>
<span class="c1"># ...
</span><span class="k">elif</span> <span class="n">last_key</span> <span class="o">==</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">ts</span> <span class="o">-</span> <span class="n">last_ts</span> <span class="o">&lt;=</span> <span class="n">TS_DELTA</span><span class="p">:</span>
	<span class="c1"># ...
</span><span class="k">elif</span> <span class="n">last_key</span> <span class="o">==</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">ts</span> <span class="o">-</span> <span class="n">last_ts</span> <span class="o">&gt;=</span> <span class="n">TS_DELTA</span><span class="p">:</span>
	<span class="c1"># The same key but more time has passed
</span>	<span class="k">print</span><span class="p">(</span><span class="n">process</span><span class="p">(</span><span class="n">last_key</span><span class="p">,</span> <span class="n">repeat</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
	<span class="n">repeat</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="n">last_ts</span> <span class="o">=</span> <span class="n">ts</span>
<span class="c1"># ...
</span></code></pre></div></div>

<p>We set a constant <code class="language-plaintext highlighter-rouge">TS_DELTA</code> as a threshold, equal to 900 ms. We run the
program again and see the results:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>python analyze.py sms1.csv
<span class="go">LEFTLEFTLEFTLEFTT9_CAPSrudolf where are you brrrLEFTLEFT0m, .l ,p
</span></code></pre></div></div>

<p>Let’s see if we can do the same with <code class="language-plaintext highlighter-rouge">sms4.csv</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="c"># Line-breaks for your sanity</span>
<span class="gp">$</span><span class="w"> </span>python analyze.py sms4.csv
<span class="go">LEFTLEFTLEFTLEFTT9_CAPSalright pal hersUPeDOWN ye flag good lucj enterUPUPUPUPUPUPUPDOWNRIGHTk
DOWNDOWNDOWNDOWNDOWNDOWNing it with those hooves lol its
aotw{l3ts_dr1nk_s0m3_eggnogRIGHTRIGHT0g_y0u_cr4zy_d33r}LEFTLEFT0m.. .l ,p
</span></code></pre></div></div>

<p>We seem to be very close to the answer. We see that the flag is split up by two
<code class="language-plaintext highlighter-rouge">RIGHT</code>s. The characters at the left and the right of the delimiter are similar
to each other. From this, we deduce that the <code class="language-plaintext highlighter-rouge">MENU_RIGHT</code> button acts as a
backspace. We make these alterations to the code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span><span class="n">KS</span> <span class="o">=</span> <span class="p">{</span>
	<span class="c1"># ...
</span>	<span class="mi">101</span><span class="p">:</span> <span class="p">[</span><span class="s">'</span><span class="se">\b</span><span class="s">'</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)],</span>
	<span class="c1"># ...
</span><span class="p">}</span>
<span class="c1"># ...
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">\b</code> is an escape sequence that brings the pointer backwards by 1 character.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="c"># Line breaks for your sanity</span>
<span class="gp">$</span><span class="w"> </span>python analyze.py sms4.csv
<span class="go">LEFTLEFTLEFTLEFTT9_CAPSalright pal hersUPeDOWN ye flag good lucj
enterUPUPUPUPUPUPUPDOWkDOWNDOWNDOWNDOWNDOWNDOWNing it with those hooves lol its
aotw{l3ts_dr1nk_s0m3_eggn0g_y0u_cr4zy_d33r}LEFTLEFT0m.. .l ,p
</span></code></pre></div></div>

<p>Also you can see that the <code class="language-plaintext highlighter-rouge">MENU_UP</code> and <code class="language-plaintext highlighter-rouge">MENU_DOWN</code> both correspond to moving
the pointer to the left and to the right, but since it doesn’t concern the
flag, we don’t need to worry about them. It is left as an exercise to the
reader to modify the above code so that it takes <code class="language-plaintext highlighter-rouge">MENU_UP</code> and <code class="language-plaintext highlighter-rouge">MENU_DOWN</code> into
account.</p>

</article>

<footer class="post-foot">
  <span class="prev">
  
    <span>Prev</span>
    <a href="/jekyll/2018/12/16/gh-jekyll-plugs.html">Github Jekyll Plugins</a>
  
  </span>
  <span class="next">
  
    <span>Next</span>
    <a href="/writeup/2019/12/31/where-go-infernoctf.html">Where did he GO? - Inferno CTF</a>
  
  </span>
</footer>

    </div>
  </body>

</html>
