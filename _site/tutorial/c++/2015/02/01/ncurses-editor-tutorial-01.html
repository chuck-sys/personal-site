<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="/css/main.css">

<!-- Custom stylesheets -->


    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>NCURSES Terminal Text Editor Tutorial Part 1 | Cheuk’s Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="NCURSES Terminal Text Editor Tutorial Part 1" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction" />
<meta property="og:description" content="Introduction" />
<meta property="og:site_name" content="Cheuk’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-02-01T08:28:00-08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="NCURSES Terminal Text Editor Tutorial Part 1" />
<script type="application/ld+json">
{"headline":"NCURSES Terminal Text Editor Tutorial Part 1","dateModified":"2015-02-01T08:28:00-08:00","datePublished":"2015-02-01T08:28:00-08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/tutorial/c++/2015/02/01/ncurses-editor-tutorial-01.html"},"description":"Introduction","@type":"BlogPosting","url":"/tutorial/c++/2015/02/01/ncurses-editor-tutorial-01.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    
  <head>

  <body>
    <div class="wrapper">
      <nav>
  <a href="/" class="nav-title">
    Cheuk's Blog
  </a>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <a class="nav-links" href="/resources/">Resources</a>
  
  
  
  
  
  
  
  
  
  
  
  <a class="nav-links" href="/about/">About</a>
  
  
</nav>

      
      <article class="post">
  <h1 class="title">NCURSES Terminal Text Editor Tutorial Part 1</h1>
  <span>
    <span>
    Tags:
    
    <a href="/tag/tutorial">
      tutorial
    </a>
    
    <a href="/tag/c++">
      c++
    </a>
    
    <a href="/tag/ncurses">
      ncurses
    </a>
    
    <a href="/tag/editor">
      editor
    </a>
    
    </span>
    <span class="meta">01 Feb 2015</span>
  </span>

  

<ul class="nav nav-pills">
  
  

  

  

  
      <li><a href="/tutorial/c++/2015/02/01/ncurses-editor-tutorial-01.html">NCURSES Terminal Text Editor Tutorial Part 1</a></li>
  

  
      <li><a href="/tutorial/c++/2015/02/01/ncurses-editor-tutorial-02.html">NCURSES Terminal Text Editor Tutorial Part 2</a></li>
  

  
      <li><a href="/tutorial/c++/2015/02/04/ncurses-editor-tutorial-03.html">NCURSES Terminal Text Editor Tutorial Part 3</a></li>
  

  
      <li><a href="/tutorial/c++/2015/02/07/ncurses-editor-tutorial-04.html">NCURSES Terminal Text Editor Tutorial Part 4</a></li>
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  


</ul>

<h2 id="introduction">Introduction</h2>

<p>I am using vim right now, and a few days ago, I thought to myself:</p>

<blockquote>
  <p>If they can make a terminal text editor, why can’t I try?</p>
</blockquote>

<p>So I set out to create a small TE that is just a proof-of-concept. I am here to
share my findings with the Internet. You may find the complete source code (with
all of the small-to-big bugs) <a href="https://github.com/cheukyin699/ceditor-test/">here</a>. You may find this tutorial’s source
code <a href="/res/tutorials/ncurses-ced-tut.tar.gz">here</a>.</p>

<p>We are going to make a small text editor with basic saving, editing, and exiting
features. You may expand it however you like.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>This tutorial assumes adequate fluency in the C++ language, and a bit of
understanding of the ncurses library.</p>

<h2 id="so-lets-start-shall-we">So Let’s Start, Shall We?</h2>

<p>Let’s start with how the text editor is structured.</p>

<p>We are just going to have a while-loop accepting keyboard input and then
updating the screen accordingly.</p>

<p>Keeping that in mind, lets start with the most important file: <code class="language-plaintext highlighter-rouge">Main.cpp</code></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;ncurses.h&gt;
#include &lt;string&gt;
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">curses_init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">initscr</span><span class="p">();</span>                      <span class="c1">// Start ncurses mode</span>
    <span class="n">noecho</span><span class="p">();</span>                       <span class="c1">// Don't echo keystrokes</span>
    <span class="n">cbreak</span><span class="p">();</span>                       <span class="c1">// Disable line buffering</span>
    <span class="n">keypad</span><span class="p">(</span><span class="n">stdscr</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>           <span class="c1">// Enable special keys to be recorded</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">string</span> <span class="n">fn</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>               <span class="c1">// Set the filename</span>
    <span class="p">}</span>

    <span class="n">curses_init</span><span class="p">();</span>                  <span class="c1">// Initialize ncurses</span>

    <span class="n">refresh</span><span class="p">();</span>                      <span class="c1">// Refresh display</span>
    <span class="n">endwin</span><span class="p">();</span>                       <span class="c1">// End ncurses mode</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To compile, do:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g++ <span class="nt">-c</span> Main.c <span class="nt">-o</span> Main.o
g++ Main.o <span class="nt">-lncurses</span> <span class="nt">-o</span> editor
</code></pre></div></div>

<p>Or just put it in a <code class="language-plaintext highlighter-rouge">Makefile</code>.</p>

<p>We are going to add other things to this file later so don’t lose it.</p>

<h2 id="the-buffer-class">The Buffer Class</h2>

<p>The Buffer class is going to represent a buffer of text. I’m going to use a
vector of strings. It provides easy methods to insert, append, as well as delete
lines. One string is a line of text. Create <code class="language-plaintext highlighter-rouge">Buffer.h</code>.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifndef BUFFER_H
#define BUFFER_H
</span>
<span class="cp">#include &lt;string&gt;
#include &lt;vector&gt;
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Buffer</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">Buffer</span><span class="p">();</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">lines</span><span class="p">;</span>

    <span class="cm">/* Some helper functions */</span>
    <span class="kt">void</span> <span class="n">insertLine</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
    <span class="kt">void</span> <span class="n">appendLine</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
    <span class="kt">void</span> <span class="n">removeLine</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

    <span class="cm">/* Substitutes all tabs in string for 4 spaces, so that
     * the tabs won't screw everything up */</span>
    <span class="n">string</span> <span class="n">remTabs</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#endif
</span></code></pre></div></div>

<h2 id="the-editor-class">The Editor Class</h2>

<p>I don’t like to put too many things in my <code class="language-plaintext highlighter-rouge">Main.cpp</code> file, so I put everything
in other files. Create your <code class="language-plaintext highlighter-rouge">Editor.h</code>. It will be used to handle the keyboard
inputs that we send it. It is also there to refresh the display. It will also
contain a buffer.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifndef EDITOR_H
#define EDITOR_H
</span>
<span class="cp">#include &lt;ncurses.h&gt;
</span>
<span class="cp">#include "Buffer.h"
</span>
<span class="k">class</span> <span class="nc">Editor</span>
<span class="p">{</span>
<span class="nl">private:</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">mode</span><span class="p">;</span>
    <span class="n">Buffer</span><span class="o">*</span> <span class="n">buff</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">status</span><span class="p">,</span> <span class="n">filename</span><span class="p">;</span>

    <span class="cm">/* For those of you who do not have -std=c++11 in g++ */</span>
    <span class="n">string</span> <span class="n">tos</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

    <span class="c1">// Cursor movement</span>
    <span class="kt">void</span> <span class="n">moveUp</span><span class="p">();</span>
    <span class="kt">void</span> <span class="n">moveDown</span><span class="p">();</span>
    <span class="kt">void</span> <span class="n">moveLeft</span><span class="p">();</span>
    <span class="kt">void</span> <span class="n">moveRight</span><span class="p">();</span>

    <span class="kt">void</span> <span class="n">deleteLine</span><span class="p">();</span>                  <span class="c1">// Deletes current line</span>
    <span class="kt">void</span> <span class="n">deleteLine</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>               <span class="c1">// Deletes line &lt;int&gt;</span>

    <span class="kt">void</span> <span class="n">saveFile</span><span class="p">();</span>                    <span class="c1">// Saves buffer into the file</span>

<span class="nl">public:</span>
    <span class="n">Editor</span><span class="p">();</span>                           <span class="c1">// Normal constructor</span>
    <span class="n">Editor</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>                     <span class="c1">// Constructor accepting filename</span>

    <span class="kt">char</span> <span class="n">getMode</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">mode</span><span class="p">;}</span>

    <span class="kt">void</span> <span class="n">handleInput</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>              <span class="c1">// Handles keyboard input</span>
    <span class="kt">void</span> <span class="n">printBuff</span><span class="p">();</span>
    <span class="kt">void</span> <span class="n">printStatusLine</span><span class="p">();</span>             <span class="c1">// Prints the status line (like vim!!!)</span>
    <span class="kt">void</span> <span class="n">updateStatus</span><span class="p">();</span>                <span class="c1">// Updates the status line (text, not display)</span>
<span class="p">};</span>

<span class="cp">#endif
</span></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">int x, y;</code> is just for the x and y positions on screen. The <code class="language-plaintext highlighter-rouge">string status</code>
will be displayed at the bottom (or that is our goal).</p>

<h2 id="putting-things-together">Putting Things Together</h2>

<p>Now, after all this prototyping, and even though we haven’t implemented anything
(much), lets edit our <code class="language-plaintext highlighter-rouge">Main.cpp</code> to reflect the changes.</p>

<p>First, include the necessary header file.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "Editor.h"
</span></code></pre></div></div>

<p>Then, add this to the start of your <code class="language-plaintext highlighter-rouge">main</code> function.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Editor</span> <span class="n">ed</span><span class="p">;</span>
</code></pre></div></div>

<p>Remember the if-statements that we use to check for a filename?</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">ed</span> <span class="o">=</span> <span class="n">Editor</span><span class="p">(</span><span class="n">fn</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="n">ed</span> <span class="o">=</span> <span class="n">Editor</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We will later implement the constructors. For now, that will do.</p>

<p>Now lets add the main while-loop. After <code class="language-plaintext highlighter-rouge">curses_init()</code>, add this.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">getMode</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'x'</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ed</span><span class="p">.</span><span class="n">updateStatus</span><span class="p">();</span>
    <span class="n">ed</span><span class="p">.</span><span class="n">printStatusLine</span><span class="p">();</span>
    <span class="n">ed</span><span class="p">.</span><span class="n">printBuff</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">input</span> <span class="o">=</span> <span class="n">getch</span><span class="p">();</span>                <span class="c1">// Blocking until input</span>
    <span class="n">ed</span><span class="p">.</span><span class="n">handleInput</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>A small explanation: <code class="language-plaintext highlighter-rouge">Editor::getMode()</code> returns a char representing a mode.
There are (currently) 3 modes.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">x</code>: Exit mode</li>
  <li><code class="language-plaintext highlighter-rouge">n</code>: Normal mode</li>
  <li><code class="language-plaintext highlighter-rouge">i</code>: Insert mode</li>
</ul>

<p>Exit mode exits the program by quitting the while loop. Normal mode lets you
enter commands. Insert mode lets you type text and interact with the editor’s
internal buffer.</p>

<p>Okay, we are done the basic skeleton of the TE! Over the course of the other
tutorials, you will be filling in the gaps - implementing every function that
was declared here. You are now ready for Part 2!</p>



<ul class="nav nav-pills">
  
  

  

  

  
      <li><a href="/tutorial/c++/2015/02/01/ncurses-editor-tutorial-01.html">NCURSES Terminal Text Editor Tutorial Part 1</a></li>
  

  
      <li><a href="/tutorial/c++/2015/02/01/ncurses-editor-tutorial-02.html">NCURSES Terminal Text Editor Tutorial Part 2</a></li>
  

  
      <li><a href="/tutorial/c++/2015/02/04/ncurses-editor-tutorial-03.html">NCURSES Terminal Text Editor Tutorial Part 3</a></li>
  

  
      <li><a href="/tutorial/c++/2015/02/07/ncurses-editor-tutorial-04.html">NCURSES Terminal Text Editor Tutorial Part 4</a></li>
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  


</ul>

</article>

<footer class="post-foot">
  <span class="prev">
  
    <span>Prev</span>
    <a href="/exercise/2015/01/26/wallclimbing-is-tiring.html">Wallclimbing is tiring</a>
  
  </span>
  <span class="next">
  
    <span>Next</span>
    <a href="/tutorial/c++/2015/02/01/ncurses-editor-tutorial-02.html">NCURSES Terminal Text Editor Tutorial Part 2</a>
  
  </span>
</footer>

    </div>
  </body>

</html>
